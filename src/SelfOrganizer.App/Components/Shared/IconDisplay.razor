@* Universal icon display component that handles Open Iconic, emoji, and custom images *@

@if (!string.IsNullOrEmpty(IconImageUrl))
{
    <img src="@IconImageUrl"
         alt="@(AltText ?? "Icon")"
         class="icon-display icon-image @SizeClass @CssClass"
         style="width: @SizePixels; height: @SizePixels; object-fit: cover; border-radius: 4px;"
         data-testid="icon-display-image" />
}
else if (!string.IsNullOrEmpty(Icon))
{
    @if (IsEmoji(Icon))
    {
        <span class="icon-display icon-emoji @SizeClass @CssClass"
              style="font-size: @EmojiFontSize; line-height: 1;"
              role="img"
              aria-label="@(AltText ?? Icon)"
              data-testid="icon-display-emoji">@Icon</span>
    }
    else
    {
        <span class="icon-display oi @Icon @SizeClass @CssClass"
              aria-hidden="true"
              data-testid="icon-display-oi"></span>
    }
}
else if (!string.IsNullOrEmpty(DefaultIcon))
{
    @if (IsEmoji(DefaultIcon))
    {
        <span class="icon-display icon-emoji @SizeClass @CssClass text-muted"
              style="font-size: @EmojiFontSize; line-height: 1; opacity: 0.5;"
              role="img"
              aria-label="@(AltText ?? "Default icon")"
              data-testid="icon-display-default">@DefaultIcon</span>
    }
    else
    {
        <span class="icon-display oi @DefaultIcon @SizeClass @CssClass text-muted"
              style="opacity: 0.5;"
              aria-hidden="true"
              data-testid="icon-display-default"></span>
    }
}

@code {
    [Parameter] public string? Icon { get; set; }
    [Parameter] public string? IconImageUrl { get; set; }
    [Parameter] public string? DefaultIcon { get; set; }
    [Parameter] public string? AltText { get; set; }
    [Parameter] public string? CssClass { get; set; }
    [Parameter] public IconSize Size { get; set; } = IconSize.Medium;

    public enum IconSize
    {
        Small,   // 24px
        Medium,  // 32px
        Large    // 48px
    }

    private string SizeClass => Size switch
    {
        IconSize.Small => "icon-size-small",
        IconSize.Large => "icon-size-large",
        _ => "icon-size-medium"
    };

    private string SizePixels => Size switch
    {
        IconSize.Small => "24px",
        IconSize.Large => "48px",
        _ => "32px"
    };

    private string EmojiFontSize => Size switch
    {
        IconSize.Small => "1.25rem",
        IconSize.Large => "2.5rem",
        _ => "1.75rem"
    };

    private static bool IsEmoji(string? text)
    {
        if (string.IsNullOrEmpty(text)) return false;
        // Open Iconic classes start with "oi-"
        if (text.StartsWith("oi-")) return false;
        // Emoji are typically 1-4 characters with high unicode points
        return text.Length <= 4 && text.Any(c => char.IsHighSurrogate(c) || c > 127);
    }
}
